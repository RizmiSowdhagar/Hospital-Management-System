<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <title>Morris Health Services</title>
    <style>
        html, body {
            font-family: 'Times New Roman', Times, serif;
            margin: 0;
            padding: 0;
            overflow: auto;
        }

        body {
            background-image: url("https://img.freepik.com/premium-photo/clinical-serenity-empty-hospital-corridor-with-room-background_856434-144.jpg");
            background-repeat: no-repeat;
            background-size: cover; /* Cover the entire background */
            background-position: center; /* Center the background image */
            padding-bottom: 100%; /* Set padding-bottom to 100% of the width of the body */
            background-color: rgba(255, 255, 255, 0.5);
        }

        header {
            background-color: #007bff;
            opacity: 40%;
            width: 100%;
            height: 14%;
            margin-top: 2%;
            text-align: center;
            padding: 20px 0;
            position: relative;
            position: absolute;
        }

        h1 {
            color: black;
            font-family: 'Times New Roman', Times, serif;
            font-style: bold;
            position: relative;
            position:absolute;
            margin-left: 37%;
            margin-top: 5.5%;
        }

        h2 {
            color: black;
            font-family: 'Times New Roman', Times, serif;
            font-style: bold;
            position: relative;
            position: absolute;
            margin-top: 16%;
            margin-left: 39%;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            position: relative;
            position: absolute;
            margin-top: 32%;
            background-color: rgba(255, 255, 255, 0.8);
        }

        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }

        td {
            background-color: #f2f2f2;
        }

        th {
            background-color: #e0e0e0;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            width: 25%;
        }

        button:hover {
            background-color: #0056b3;
        }

        form {
            margin-top: 22%;
            position: relative;
            position: absolute;
        }

        #report-table {
            display: none;
        }

    </style>
    <!-- Include Morris.js and its dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.3.0/raphael.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.min.js"></script>
</head>
<body>
<header>
</header>
<h1>Morris Health Services</h1>
<main>
    <a href="report.html">
        <button style="position: relative; position: absolute; margin-top: 16%;  width: 5%; ">
            <i class="fa fa-arrow-left" aria-hidden="true"></i>
        </button>
    </a>
    <h2>Insurance Revenue Report</h2>

    <form method="post" onsubmit="fetchAppointments(event)">
        <label for="begin_date">Begin Date:</label>
        <input type="date" id="begin_date" name="begin_date">

        <label for="end_date">End Date:</label>
        <input type="date" id="end_date" name="end_date">

        <button style="width: 50%; position: relative;
        position: absolute;
        margin-left: 3%;
        margin-top: -2%;" type="submit" name="submit">Generate Report</button>
    </form>

    <div id="report-table">
        <table border='1'>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Insurance Company</th>
                    <th>Average Daily Revenue</th>
                </tr>
            </thead>
            <tbody>
                <!-- Table rows will be dynamically added here -->
            </tbody>
        </table>
    </div>
    

    <script>
        function fetchAppointments(event) {
            event.preventDefault(); // Prevent form submission
            
            // Retrieve begin date and end date from form
            const beginDate = document.getElementById('begin_date').value;
            const endDate = document.getElementById('end_date').value;
            
            // Create a new XMLHttpRequest object
            const xhr = new XMLHttpRequest();
            
            // Configure the request
            xhr.open('POST', 'revenue_insurance.php', true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            
            // Define what happens on successful data submission
            xhr.onload = function() {
                if (xhr.status >= 200 && xhr.status < 300) {
                    console.log('Response from server:', xhr.responseText); // Add this line
                    try {
                        const data = JSON.parse(xhr.responseText);
                        displayAppointments(data);
                    } catch (error) {
                        console.error('Error parsing JSON response:', error);
                    }
                } else {
                    console.error('Request failed with status:', xhr.status);
                }
            };
            
            // Define what happens in case of error
            xhr.onerror = function() {
                console.error('Request failed');
            };
            
            // Send the request
            xhr.send('begin_date=' + encodeURIComponent(beginDate) + '&end_date=' + encodeURIComponent(endDate));
        }
        function displayAppointments(appointments) {
            const tableBody = document.querySelector('#report-table table tbody');
            tableBody.innerHTML = ''; // Clear previous data
        
            appointments.forEach(appointment => {
                const newRow = document.createElement('tr');
                const dateCell = document.createElement('td');
                const insuranceCompanyCell = document.createElement('td'); // Change variable name
                const avgDailyRevenueCell = document.createElement('td'); // Change variable name
        
                dateCell.textContent = appointment.REVENUE_DATE;
                insuranceCompanyCell.textContent = appointment.INSURANCE_COMPANY;
                avgDailyRevenueCell.textContent = appointment.AVG_DAILY_REVENUE; // Adjust to match data structure
        
                newRow.appendChild(dateCell);
                newRow.appendChild(insuranceCompanyCell);
                newRow.appendChild(avgDailyRevenueCell);
        
                tableBody.appendChild(newRow);
            });
        
            // Show the table
            document.getElementById('report-table').style.display = 'block';
        }
        
    </script>
</main>
<footer>
</footer>
</body>
</html>
